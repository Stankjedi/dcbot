# 🚀 프로젝트 개선 탐색 보고서

> 이 문서는 Vibe Coding Report VS Code 확장에서 자동으로 관리됩니다.  
> **적용된 개선 항목은 자동으로 필터링되어 미적용 항목만 표시됩니다.**
>
> 💡 **구체적인 구현 코드는 `Prompt.md` 파일을 참조하세요.**

---

<!-- AUTO-OVERVIEW-START -->
## 📋 프로젝트 정보

| 항목 | 값 |
|------|-----|
| **프로젝트명** | dcbot |
| **최초 분석일** | 2025-12-29 10:47 |
<!-- AUTO-OVERVIEW-END -->

---

<!-- AUTO-ERROR-EXPLORATION-START -->
## 🔍 오류 및 리스크 탐색 절차

> 이 섹션은 개선 항목이 어떤 기준으로 도출되었는지를 설명합니다.

### 1. 데이터 수집
- 최근 빌드/테스트/런타임 로그 분석
- VS Code 문제 패널(Problems) 확인
- Git diff 및 커밋 메시지 검토
- TODO/FIXME 주석 스캔

### 2. 자동 분석
- 테스트 실패/스킵 케이스 분류
- 빌드 오류/경고 메시지 그룹화
- 빈번하게 수정되는 파일/모듈 탐지
- 정적 분석(lint, type-check) 결과 검토

### 3. 개선 후보 도출
- 동일 원인의 오류/경고를 하나의 "개선 항목 후보"로 묶기
- 영향도(테스트 실패, 빌드 실패, 성능 저하)에 따라 우선순위 부여
- 프로젝트 비전과의 일치 여부 검토

### 4. 최종 백로그 정제
- 복잡도/리스크 대비 효용 검토
- Definition of Done 명시
- 관련 평가 점수 카테고리 매핑
<!-- AUTO-ERROR-EXPLORATION-END -->

---

## 📌 사용 방법

1. 이 보고서의 개선 항목을 검토합니다
2. 적용하고 싶은 항목을 선택하여 `Prompt.md`를 생성합니다
3. AI 에이전트(Copilot Chat 등)에 붙여넣어 구현을 요청합니다
4. 다음 보고서 업데이트 시 적용된 항목은 자동으로 제외됩니다

---

<!-- AUTO-SUMMARY-START -->
## 📊 개선 현황 요약

아래 내용은 **현재 코드베이스 기준으로 아직 적용되지 않은(미적용) 개선 항목만** 정리한 백로그입니다. (적용 완료 내역/세션 기록은 `Session_History.md`에서 관리)

| 상태 | 개수 |
|------|------|
| 🔴 긴급 (P1) | 0 |
| 🟡 중요 (P2) | 2 |
| 🟢 개선 (P3) | 1 |
| 🚀 최적화 (OPT) | 1 |

| # | 항목명 | 우선순위 | 카테고리 |
|:---:|:---|:---:|:---|
| 1 | LLM 전송 컨텍스트(본문/댓글) 최소화·프라이버시 제어 옵션 | P2 | 🔒 보안/프라이버시 |
| 2 | 서버 allowlist 운영 지원(확장 Origin 표시/복사 UX) | P2 | 🔒 보안/운영 |
| 3 | 옵션에서 처리된 댓글(handled) 초기화 | P3 | ✨ 기능 추가 / 🧑‍💻 운영 |
| 4 | 최근 댓글 컨텍스트 추출 최적화(루트 전체 스캔 제거) | OPT | 🚀 최적화 |

- **P1:** 현재 미적용 긴급 항목은 없습니다(핵심 보안 가드/테스트/CI는 구축됨).
- **P2:** “프라이버시/운영 오설정” 리스크를 줄이는 설정/UX 보강이 중심입니다.
- **P3/OPT:** 운영 편의(상태 초기화)와 답변 생성 시점의 추가 성능 최적화로 실사용 안정성을 높입니다.
<!-- AUTO-SUMMARY-END -->

---

<!-- AUTO-TODO-FIXME-START -->
## 🧾 TODO/FIXME 발견 요약

*TODO/FIXME 항목이 없습니다.*
<!-- AUTO-TODO-FIXME-END -->

---

<!-- AUTO-IMPROVEMENT-LIST-START -->
## 📝 개선 항목 목록

### 🔴 중요 (P1)
- 현재 미적용 P1 항목은 없습니다.

### 🟡 중요 (P2)

#### [P2-1] LLM 전송 컨텍스트(본문/댓글) 최소화·프라이버시 제어 옵션

| 항목 | 내용 |
|------|------|
| **ID** | `sec-privacy-context-controls-001` |
| **카테고리** | 🔒 보안 / 🧑‍💻 운영 |
| **복잡도** | Medium |
| **대상 파일** | `src/lib/storage/settings.ts`, `src/lib/storage/settings.test.ts`, `src/entrypoints/options/App.tsx`, `src/entrypoints/content-scripts/dcinside.ts`, `src/lib/llm/prompt.ts`, `src/lib/llm/prompt.test.ts`, `README.md` |
| **Origin** | manual-idea |
| **리스크 레벨** | medium |
| **관련 평가 카테고리** | security, productionReadiness, usability |

- **현재 상태:** 답변 생성 시 글 제목/본문 일부, 최근 댓글 일부, 검색 결과 등이 프롬프트 컨텍스트로 사용될 수 있으나, 사용자가 “어떤 컨텍스트를 포함/제외할지”를 설정에서 명확히 제어하기 어렵습니다.
- **문제점 (Problem):** 개인정보/민감정보가 포함될 수 있는 컨텍스트가 의도치 않게 포함될 수 있고, 운영 정책(최소 수집/최소 전송)에 맞춘 설정이 어렵습니다.
- **영향 (Impact):** 프라이버시 리스크 증가, 운영 환경(업무/개인/공용 PC)에서 사용 제한 요인, 사용자 신뢰 저하.
- **원인 (Cause):** 컨텍스트 구성(본문/댓글/검색)을 기능 중심으로 설계했고, 프라이버시 프리셋/옵션이 부족합니다.
- **개선 내용 (Proposed Solution):**
  - (1) 설정에 컨텍스트 포함 옵션 추가(예: 본문 포함 여부, 최근 댓글 포함 여부, 최근 댓글 최대 개수 등)
  - (2) 옵션 UI에서 위험/효과를 간단히 설명하고 “프라이버시 모드(최소 컨텍스트)” 같은 프리셋 제공(선택)
  - (3) 프롬프트 빌더가 옵션을 엄격히 반영하도록 하고, 테스트로 회귀 방지
- **기대 효과:** 사용자/운영자가 데이터 전송 범위를 통제할 수 있어 프라이버시/정책 리스크를 낮추고, 환경별 사용성을 개선.

**Definition of Done**
- [ ] `Settings`에 컨텍스트 제어 옵션 추가 및 정규화/클램프 구현
- [ ] 옵션 UI에 토글/프리셋 제공(설명 포함)
- [ ] 프롬프트 빌더/콘텐츠 스크립트가 옵션을 반영(본문/최근 댓글/검색 컨텍스트 조건부 포함)
- [ ] 관련 단위 테스트 추가 및 통과
- [ ] 빌드/테스트/컴파일 통과 및 README 업데이트(필요 시)

#### [P2-2] 서버 allowlist 운영 지원(확장 Origin 표시/복사 UX)

| 항목 | 내용 |
|------|------|
| **ID** | `sec-proxy-allowlist-ux-001` |
| **카테고리** | 🔒 보안 / 🧑‍💻 운영 |
| **복잡도** | Low |
| **대상 파일** | `src/entrypoints/options/App.tsx`, `README.md`(선택) |
| **Origin** | manual-idea |
| **리스크 레벨** | low |
| **관련 평가 카테고리** | security, productionReadiness, usability |

- **현재 상태:** 서버는 `DCBOT_ALLOWED_ORIGINS`로 allowlist를 지원하지만, 사용자는 확장 Origin(`chrome-extension://<id>`)을 스스로 찾아야 합니다(문서 의존).
- **문제점 (Problem):** 확장 ID/Origin을 잘못 입력하면 서버가 403을 반환하거나, 운영자가 allowlist를 포기하고 더 넓은 정책으로 운영할 가능성이 있습니다.
- **영향 (Impact):** 운영 오설정으로 인한 장애(접속 불가) 및 보안 정책 약화(넓은 허용 정책 선택) 가능.
- **원인 (Cause):** 확장 내부에서 확장 Origin을 “정확히 표시/복사”하는 UX가 없음.
- **개선 내용 (Proposed Solution):** 옵션 UI에 확장 ID/Origin을 표시하고, 원클릭 복사 버튼을 제공(서버 `.env` 설정에 그대로 사용 가능). 필요 시 README에 안내를 보강.
- **기대 효과:** allowlist 운영 진입 장벽을 낮춰 오설정·운영 실패를 줄이고, 더 엄격한 보안 정책을 적용하기 쉬워짐.

**Definition of Done**
- [ ] 옵션 UI에 `chrome-extension://<id>` Origin 표시 + 복사 버튼 추가
- [ ] 사용자에게 allowlist 설정 가이드를 간단히 안내(필요 시 README 보강)
- [ ] 빌드/테스트/컴파일 통과
<!-- AUTO-IMPROVEMENT-LIST-END -->

---

<!-- AUTO-OPTIMIZATION-START -->
## 🚀 코드 품질 및 성능 최적화

> 기존 기능을 해치지 않으면서 코드 품질과 성능을 향상시킬 수 있는 개선점입니다.

### 일반 분석(요약)
- **중복 코드 및 유틸 함수로 추출 가능한 부분:** URL 빌더/진단 문자열/에러 메시지 정규화가 여러 레이어(콘텐츠/백그라운드/옵션)에 분산되어 있습니다.
- **타입 안정성 강화 필요 구간 (`any` 남용 등):** 외부 JSON(프록시 응답), DOM 파싱 결과 등 런타임 구조가 유동적인 구간은 방어적 타입 가드/클램프를 더 체계화할 여지가 있습니다.
- **가독성을 해치는 복잡한 함수/파일:** `src/entrypoints/content-scripts/dcinside.ts`는 역할이 많아(스캔/명령 파싱/UI/상태) 점진적 분리가 유효합니다.
- **에러 처리 로직이 부족하거나 일관되지 않은 부분:** “차단(가드)” vs “실패(오류)” 메시지의 사용자 표기 규칙을 더 정리할 수 있습니다.
- **불필요한 연산, 비효율적인 비동기 처리, 캐싱 부재 구간:** 답변 생성 시점에 “최근 댓글 컨텍스트”를 만들기 위해 루트 전체를 스캔하는 경로가 남아 있어, 대형 스레드에서 순간 부하를 줄일 여지가 있습니다.

### 🚀 코드 최적화 (OPT-1) 최근 댓글 컨텍스트 추출 최적화(루트 전체 스캔 제거)

| 항목 | 내용 |
|------|------|
| **ID** | `opt-recent-comments-context-001` |
| **카테고리** | 🚀 코드 최적화 / ⚙️ 성능 튜닝 |
| **영향 범위** | 성능 / 품질 |
| **대상 파일** | `src/entrypoints/content-scripts/dcinside.ts`, `src/lib/adapter/dcinsideAdapter.ts`(선택), `src/lib/util/context.ts`(선택) |

- **현재 상태:** 답변 생성 시 `getRecentCommentsContext(...)`가 `adapter.listComments(root)`를 호출해 전체 목록을 만든 뒤 창(window)을 선택합니다. 스레드가 매우 길면 “생성 버튼 클릭 시점”에 순간 CPU 부하가 생길 수 있습니다.
- **최적화 내용:** (1) 트리거 댓글 DOM을 기준으로 인접 형제/근처 컨테이너를 순회하여 N개만 수집(상한/정규화/길이 제한) (2) 전체 스캔 기반 로직은 폴백으로만 남기기(근처 탐색 실패 시) (3) fixture 테스트로 회귀 경계 설정.
- **예상 효과:** 대형 스레드에서 답변 생성 클릭 시 순간 지연 감소, UI 반응성 개선, 배터리 사용량 감소.
- **측정 지표:** (a) 최근 댓글 추출 시간(ms) (b) 생성 클릭~미리보기 표시까지 지연 (c) 수집된 댓글 수/평균 길이(상한 준수) 비교.
<!-- AUTO-OPTIMIZATION-END -->

---

<!-- AUTO-FEATURE-LIST-START -->
## ✨ 기능 추가 항목

### 🟢 개선 (P3)

#### [P3-1] 옵션에서 처리된 댓글(handled) 초기화

| 항목 | 내용 |
|------|------|
| **ID** | `feat-reset-handled-comments-001` |
| **카테고리** | ✨ 기능 추가 / 🧑‍💻 사용성 / 🔧 운영 |
| **복잡도** | Low |
| **대상 파일** | `src/lib/storage/localState.ts`, `src/lib/rpc/types.ts`, `src/entrypoints/background/service.ts`, `src/entrypoints/options/App.tsx` |
| **Origin** | manual-idea |
| **리스크 레벨** | low |
| **관련 평가 카테고리** | usability, productionReadiness |

- **현재 상태:** 처리된 댓글 ID는 `storage.local`에 누적되어 중복 처리를 막지만, 사용자가 “다시 처리하고 싶을 때” 이를 초기화하는 UI가 없습니다.
- **기능 목적/가치:** 디버그/재시도/데모 시나리오에서 처리 상태를 빠르게 초기화해 반복 테스트 및 운영 편의를 높입니다.
- **의존/연동:** `localState`의 handled map, 백그라운드 RPC(스토리지 접근 권한), 옵션 UI.
- **제안 구현 전략:** (1) `localState`에 clear 함수 추가 (2) 백그라운드에 RPC 메서드 노출 (3) 옵션 UI에 “처리 상태 초기화” 버튼 + 확인 다이얼로그 + (선택) 현재 개수 표시.
- **기대 효과:** 운영·디버깅 효율 향상, 사용자 self-troubleshooting 보조.

**Definition of Done**
- [ ] handled map 초기화 함수 및 RPC 구현
- [ ] 옵션 UI에 초기화 버튼 + 확인 UX 추가
- [ ] 초기화 후 재시도 동작이 기대대로 동작(새로고침 후 재처리 가능)
- [ ] 빌드/테스트/컴파일 통과
<!-- AUTO-FEATURE-LIST-END -->
